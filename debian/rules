#!/usr/bin/make -f

export TMPDIR := $(shell mktemp -d)

%:
	dh $@

override_dh_install:
	# Unpack
	unsquashfs -f -d $(TMPDIR) recovery/recovery.rfs

	# Remove default init script
	rm $(TMPDIR)/init || true
	# Move new init
	cp init $(TMPDIR)
	# Move main OS installer script
	cp pt-os-installer $(TMPDIR)

	# Repack
	rm recovery/recovery.rfs
	mksquashfs $(TMPDIR) recovery/recovery.rfs

	# Clean up temporary directory
	rm -rf $(TMPDIR)

	# Proceed with normal Debian packaging install stage
	dh_install
